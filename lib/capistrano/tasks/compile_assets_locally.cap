namespace :deploy do
  desc "compiles assets locally then rsyncs"
  task :compile_assets_locally do
    run_locally do
      execute "RAILS_ENV=#{fetch(:rails_env)} bundle exec rake assets:precompile"
    end
    on roles(:web) do |role|
      upload! './public/assets/', "#{release_path}/public/", recursive: true
    end
    run_locally do
      execute "rm -rf ./public/assets"
    end
  end
end
